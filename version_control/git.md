# Git ç¬”è®°

## ä¸€ã€Git æ˜¯ä»€ä¹ˆï¼Ÿ

- **åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ**ï¼ˆDVCSï¼‰ï¼šæ¯ä¸ªå¼€å‘è€…æœ¬åœ°éƒ½æ‹¥æœ‰å®Œæ•´çš„ä»£ç å†å²ã€‚
- ç”± Linus Torvalds äº 2005 å¹´ä¸ºç®¡ç† Linux å†…æ ¸å¼€å‘è€Œåˆ›å»ºã€‚
- æ ¸å¿ƒä¼˜åŠ¿ï¼šé«˜æ•ˆã€å®‰å…¨ã€æ”¯æŒéçº¿æ€§å¼€å‘ï¼ˆåˆ†æ”¯/åˆå¹¶ï¼‰ã€ç¦»çº¿å·¥ä½œã€‚

## äºŒã€å®‰è£…ä¸é…ç½®

### 1. å®‰è£…

- **Windows**: [Git for Windows](https://git-scm.com/)
- **macOS**: `brew install git` æˆ– Xcode Command Line Tools
- **Linux**: `sudo apt install git`ï¼ˆDebian/Ubuntuï¼‰æˆ– `sudo yum install git`ï¼ˆCentOSï¼‰

### 2. åˆå§‹é…ç½®ï¼ˆå…¨å±€ï¼‰

```bash
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"

# è®¾ç½®é»˜è®¤ç¼–è¾‘å™¨ï¼ˆå¯é€‰ï¼‰
git configure --global core.editor "code --wait"  # VS Code

# è®¾ç½®é»˜è®¤åˆ†æ”¯åï¼ˆæ¨èè®¾ä¸º main æˆ– masterï¼‰
git config --global init.defaultBranch main

# æŸ¥çœ‹æ‰€æœ‰é…ç½®
git config --list
```

> é…ç½®æ–‡ä»¶ä½ç½®ï¼š
>
> - å…¨å±€ï¼š`~/.gitconfig`
> - é¡¹ç›®çº§ï¼š`.git/config`

## ä¸‰ã€åŸºæœ¬æ¦‚å¿µ

| æ¦‚å¿µ                               | è¯´æ˜                       |
| ---------------------------------- | -------------------------- |
| **å·¥ä½œåŒºï¼ˆWorking Directoryï¼‰**    | ä½ å½“å‰ç¼–è¾‘çš„æ–‡ä»¶ç›®å½•       |
| **æš‚å­˜åŒºï¼ˆStaging Area / Indexï¼‰** | ä¸´æ—¶ä¿å­˜å³å°†æäº¤çš„æ›´æ”¹     |
| **æœ¬åœ°ä»“åº“ï¼ˆLocal Repositoryï¼‰**   | `.git` ç›®å½•ï¼ŒåŒ…å«å®Œæ•´å†å²  |
| **è¿œç¨‹ä»“åº“ï¼ˆRemote Repositoryï¼‰**  | å¦‚ GitHubã€GitLab ä¸Šçš„ä»“åº“ |
| **HEAD**                           | å½“å‰æ‰€åœ¨åˆ†æ”¯çš„æœ€æ–°æäº¤æŒ‡é’ˆ |

## å››ã€åŸºç¡€æ“ä½œæµç¨‹ï¼ˆæ—¥å¸¸å¼€å‘ï¼‰

### 1. åˆå§‹åŒ–ä»“åº“

```bash
git init                    # åˆå§‹åŒ–æ–°ä»“åº“
git init -b main            # æŒ‡å®šåˆå§‹åˆ†æ”¯åï¼ˆGit 2.28+ï¼‰
```

### 2. å…‹éš†è¿œç¨‹ä»“åº“

```bash
git clone <url>             # å…‹éš†æ•´ä¸ªä»“åº“
git clone -b <branch> <url> # å…‹éš†æŒ‡å®šåˆ†æ”¯
```

### 3. æŸ¥çœ‹çŠ¶æ€

```bash
git status                  # æŸ¥çœ‹å·¥ä½œåŒºå’Œæš‚å­˜åŒºçŠ¶æ€
git status -s               # ç®€æ´æ¨¡å¼
```

### 4. æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒº

```bash
git add <file>              # æ·»åŠ å•ä¸ªæ–‡ä»¶
git add .                   # æ·»åŠ æ‰€æœ‰ä¿®æ”¹ï¼ˆä¸åŒ…æ‹¬åˆ é™¤ï¼‰
git add -A                  # æ·»åŠ æ‰€æœ‰å˜æ›´ï¼ˆåŒ…æ‹¬æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ï¼‰
git add -u                  # ä»…æ·»åŠ å·²è·Ÿè¸ªæ–‡ä»¶çš„ä¿®æ”¹/åˆ é™¤
```

### 5. æäº¤æ›´æ”¹

```bash
git commit -m "æè¿°ä¿¡æ¯"
git commit                  # æ‰“å¼€ç¼–è¾‘å™¨å†™å¤šè¡Œæäº¤ä¿¡æ¯
```

> âœ… æäº¤ä¿¡æ¯è§„èŒƒå»ºè®®ï¼š
>
> ```
> feat: æ–°åŠŸèƒ½
> fix: ä¿®å¤ bug
> docs: æ–‡æ¡£æ›´æ–°
> style: ä»£ç æ ¼å¼è°ƒæ•´
> refactor: é‡æ„ï¼ˆæ— åŠŸèƒ½å˜åŒ–ï¼‰
> test: æµ‹è¯•ç›¸å…³
> chore: æ„å»º/ä¾èµ–ç­‰æ‚é¡¹
> ```

### 6. æŸ¥çœ‹å†å²

```bash
git log                     # å®Œæ•´æ—¥å¿—
git log --oneline           # ä¸€è¡Œæ˜¾ç¤º
git log --graph --all       # å›¾å½¢åŒ–åˆ†æ”¯å†å²
git log -p -2               # æ˜¾ç¤ºæœ€è¿‘2æ¬¡æäº¤çš„å·®å¼‚
```

### 7. å·®å¼‚å¯¹æ¯”

```bash
git diff                    # å·¥ä½œåŒº vs æš‚å­˜åŒº
git diff --staged           # æš‚å­˜åŒº vs æœ€è¿‘ä¸€æ¬¡æäº¤
git diff HEAD               # å·¥ä½œåŒº vs æœ€è¿‘ä¸€æ¬¡æäº¤
git diff branch1..branch2   # ä¸¤ä¸ªåˆ†æ”¯å·®å¼‚
```

## äº”ã€åˆ†æ”¯ç®¡ç†ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

### 1. åˆ›å»ºä¸åˆ‡æ¢

```bash
git branch                  # åˆ—å‡ºæœ¬åœ°åˆ†æ”¯
git branch <name>           # åˆ›å»ºåˆ†æ”¯
git checkout <branch>       # åˆ‡æ¢åˆ†æ”¯ï¼ˆæ—§ï¼‰
git switch <branch>         # åˆ‡æ¢åˆ†æ”¯ï¼ˆæ–°ï¼ŒGit 2.23+ï¼‰
git switch -c <new-branch>  # åˆ›å»ºå¹¶åˆ‡æ¢
```

### 2. åˆå¹¶åˆ†æ”¯

```bash
git merge <branch>          # å°† <branch> åˆå¹¶åˆ°å½“å‰åˆ†æ”¯
```

- **Fast-forward åˆå¹¶**ï¼šæ— å†²çªï¼Œç›´æ¥ç§»åŠ¨æŒ‡é’ˆã€‚
- **ä¸‰æ–¹åˆå¹¶ï¼ˆThree-way mergeï¼‰**ï¼šäº§ç”Ÿæ–°åˆå¹¶æäº¤ã€‚

### 3. åˆ é™¤åˆ†æ”¯

```bash
git branch -d <branch>      # å®‰å…¨åˆ é™¤ï¼ˆå·²åˆå¹¶ï¼‰
git branch -D <branch>      # å¼ºåˆ¶åˆ é™¤
```

### 4. é‡å‘½ååˆ†æ”¯

```bash
git branch -m <old> <new>
```

## å…­ã€è¿œç¨‹ä»“åº“æ“ä½œ

### 1. æŸ¥çœ‹è¿œç¨‹

```bash
git remote -v               # æ˜¾ç¤ºè¿œç¨‹ä»“åº“åœ°å€
git remote show origin      # è¯¦ç»†ä¿¡æ¯
```

### 2. æ¨é€

```bash
git push origin main        # æ¨é€æœ¬åœ° main åˆ°è¿œç¨‹ origin/main
git push -u origin main     # é¦–æ¬¡æ¨é€å¹¶è®¾ç½®ä¸Šæ¸¸è·Ÿè¸ª
```

### 3. æ‹‰å–

```bash
git fetch                   # è·å–è¿œç¨‹æ›´æ–°ï¼ˆä¸åˆå¹¶ï¼‰
git pull                    # fetch + mergeï¼ˆç­‰ä»·äº git fetch && git mergeï¼‰
git pull --rebase           # fetch + rebaseï¼ˆæ¨èï¼Œä¿æŒçº¿æ€§å†å²ï¼‰
```

> âš ï¸ `pull` å¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„åˆå¹¶æäº¤ï¼Œå»ºè®®ç”¨ `fetch + rebase`ã€‚

### 4. è¿œç¨‹åˆ†æ”¯ç®¡ç†

```bash
git push origin --delete <branch>   # åˆ é™¤è¿œç¨‹åˆ†æ”¯
git branch -r                       # æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯
git checkout -t origin/dev          # è·Ÿè¸ªè¿œç¨‹åˆ†æ”¯å¹¶åˆ›å»ºæœ¬åœ°åˆ†æ”¯
```

## ä¸ƒã€æ’¤é”€ä¸å›é€€

| åœºæ™¯                       | å‘½ä»¤                                                     |
| -------------------------- | -------------------------------------------------------- |
| æ’¤é”€å·¥ä½œåŒºä¿®æ”¹             | `git checkout -- <file>` æˆ– `git restore <file>`         |
| å–æ¶ˆæš‚å­˜                   | `git reset HEAD <file>` æˆ– `git restore --staged <file>` |
| ä¿®æ”¹ä¸Šä¸€æ¬¡æäº¤             | `git commit --amend`                                     |
| å›é€€åˆ°æŸæ¬¡æäº¤ï¼ˆä¿ç•™å†å²ï¼‰ | `git revert <commit>`                                    |
| å›é€€åˆ°æŸæ¬¡æäº¤ï¼ˆä¸¢å¼ƒå†å²ï¼‰ | `git reset --hard <commit>`                              |
| é‡ç½®æš‚å­˜åŒºä½†ä¿ç•™å·¥ä½œåŒº     | `git reset --mixed <commit>`ï¼ˆé»˜è®¤ï¼‰                     |

> ğŸ”’ `--hard` ä¼š**æ°¸ä¹…ä¸¢å¤±æœªæäº¤çš„æ›´æ”¹**ï¼Œæ…ç”¨ï¼

## å…«ã€æ ‡ç­¾ï¼ˆTagï¼‰

ç”¨äºæ ‡è®°å‘å¸ƒç‰ˆæœ¬ï¼ˆå¦‚ v1.0.0ï¼‰ã€‚

```bash
git tag v1.0.0                      # è½»é‡æ ‡ç­¾
git tag -a v1.0.0 -m "Release 1.0"  # é™„æ³¨æ ‡ç­¾ï¼ˆæ¨èï¼‰
git show v1.0.0                     # æŸ¥çœ‹æ ‡ç­¾ä¿¡æ¯
git push origin v1.0.0              # æ¨é€å•ä¸ªæ ‡ç­¾
git push origin --tags              # æ¨é€æ‰€æœ‰æ ‡ç­¾
```

## ä¹ã€é«˜çº§æŠ€å·§

### 1. Stashï¼ˆä¸´æ—¶å­˜å‚¨ï¼‰

```bash
git stash               # ä¿å­˜å½“å‰ä¿®æ”¹ï¼ˆæ¸…ç©ºå·¥ä½œåŒºï¼‰
git stash list          # æŸ¥çœ‹ stash åˆ—è¡¨
git stash apply         # åº”ç”¨æœ€è¿‘çš„ stashï¼ˆä¿ç•™è®°å½•ï¼‰
git stash pop           # åº”ç”¨å¹¶åˆ é™¤
git stash drop          # åˆ é™¤ stash
```

### 2. Rebaseï¼ˆå˜åŸºï¼‰

å°†ä¸€ç³»åˆ—æäº¤â€œç§»åŠ¨â€åˆ°å¦ä¸€ä¸ªåŸºåº•ä¸Šï¼Œä½¿å†å²æ›´çº¿æ€§ã€‚

```bash
git rebase main         # å°†å½“å‰åˆ†æ”¯ rebase åˆ° main
git rebase -i HEAD~3    # äº¤äº’å¼ rebaseï¼ˆåˆå¹¶/ç¼–è¾‘/åˆ é™¤æäº¤ï¼‰
```

> âš ï¸ ä¸è¦å¯¹å·²æ¨é€çš„å…¬å…±åˆ†æ”¯ä½¿ç”¨ rebaseï¼

### 3. Cherry-pickï¼ˆæ‘˜å–æäº¤ï¼‰

```bash
git cherry-pick <commit>    # å°†æŸä¸ªæäº¤åº”ç”¨åˆ°å½“å‰åˆ†æ”¯
```

### 4. Reflogï¼ˆå¼•ç”¨æ—¥å¿—ï¼‰

æ‰¾å›â€œä¸¢å¤±â€çš„æäº¤ï¼ˆå³ä½¿è¢« resetï¼‰ï¼š

```bash
git reflog
git reset --hard HEAD@{2}   # å›åˆ° reflog ä¸­çš„æŸä¸ªçŠ¶æ€
```

## åã€å¸¸ç”¨å·¥ä½œæµ

### 1. Centralized Workflowï¼ˆé›†ä¸­å¼ï¼‰

- ç±»ä¼¼ SVNï¼Œæ‰€æœ‰äººå‘åŒä¸€ä¸ª `main` åˆ†æ”¯æäº¤ã€‚
- é€‚åˆå°å‹å›¢é˜Ÿã€‚

### 2. Feature Branch Workflowï¼ˆç‰¹æ€§åˆ†æ”¯ï¼‰

- æ¯ä¸ªåŠŸèƒ½åœ¨ç‹¬ç«‹åˆ†æ”¯å¼€å‘ï¼Œå®Œæˆå PR/MR åˆå¹¶ã€‚
- GitHub/GitLab é»˜è®¤æ¨èã€‚

### 3. Git Flowï¼ˆç»å…¸æ¨¡å‹ï¼‰

- `main`ï¼šç”Ÿäº§ç¯å¢ƒ
- `develop`ï¼šé›†æˆåˆ†æ”¯
- `feature/*`ã€`release/*`ã€`hotfix/*`ï¼šå„ç±»åˆ†æ”¯
- é€‚åˆä¸¥æ ¼å‘å¸ƒå‘¨æœŸçš„é¡¹ç›®ã€‚

### 4. Forking Workflowï¼ˆå¼€æºåä½œï¼‰

- æ¯äºº fork ä¸»ä»“åº“ï¼Œå‘ upstream æ PRã€‚
- GitHub å¼€æºé¡¹ç›®æ ‡å‡†æµç¨‹ã€‚

## åä¸€ã€.gitignore æ–‡ä»¶

å¿½ç•¥ä¸éœ€è¦è¿½è¸ªçš„æ–‡ä»¶ï¼ˆå¦‚æ—¥å¿—ã€ç¼–è¯‘äº§ç‰©ã€IDE é…ç½®ï¼‰ã€‚

ç¤ºä¾‹ `.gitignore`ï¼š

```text
# å¿½ç•¥æ‰€æœ‰ .log æ–‡ä»¶
*.log

# å¿½ç•¥ node_modules
node_modules/

# å¿½ç•¥ç‰¹å®šæ–‡ä»¶
.env
.DS_Store

# ä½†ä¸å¿½ç•¥ src/.env
!src/.env
```

> åœ¨çº¿ç”Ÿæˆï¼š[https://www.gitignore.io](https://www.gitignore.io)

## åäºŒã€å¸¸è§é—®é¢˜è§£å†³

### âŒ â€œfatal: refusing to merge unrelated historiesâ€

```bash
git pull origin main --allow-unrelated-histories
```

### âŒ æäº¤äº†æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ï¼‰

1. ä½¿ç”¨ `git filter-repo`ï¼ˆæ¨èï¼‰æˆ– `BFG Repo-Cleaner` å½»åº•æ¸…é™¤å†å²ã€‚
2. **ä¸è¦åªç”¨ `reset`**ï¼Œå› ä¸ºå†å²ä»å­˜åœ¨ã€‚

### âŒ åˆ†æ”¯å†²çª

- æ‰‹åŠ¨ç¼–è¾‘å†²çªæ–‡ä»¶ï¼ˆ`<<<<<<<`, `=======`, `>>>>>>>` æ ‡è®°ï¼‰
- `git add` è§£å†³åç»§ç»­åˆå¹¶/rebase

### âŒ è¯¯åˆ åˆ†æ”¯

```bash
git reflog                # æ‰¾åˆ°åˆ†æ”¯æœ€åçš„ commit hash
git checkout -b recovery-branch <hash>
```

## åä¸‰ã€æœ€ä½³å®è·µ

âœ… **æäº¤åŸå­æ€§**ï¼šæ¯æ¬¡æäº¤åªåšä¸€ä»¶äº‹  
âœ… **å†™æ¸…æ™°çš„æäº¤ä¿¡æ¯**ï¼šè¯´æ˜â€œä¸ºä»€ä¹ˆâ€è€Œä¸æ˜¯â€œåšäº†ä»€ä¹ˆâ€  
âœ… **å°æ­¥é¢‘ç¹æäº¤**ï¼šé¿å…å¤§çˆ†ç‚¸å¼æäº¤  
âœ… **ä¸è¦æäº¤äºŒè¿›åˆ¶/æ•æ„Ÿæ–‡ä»¶**  
âœ… **ä½¿ç”¨ `.gitignore`**  
âœ… **PR å‰å…ˆ rebase ä¿æŒå†å²æ•´æ´**  
âœ… **ä¿æŠ¤ä¸»å¹²åˆ†æ”¯**ï¼ˆGitHub/GitLab è®¾ç½® branch protectionï¼‰

## åå››ã€GUI å·¥å…·æ¨è

- **å‘½ä»¤è¡Œ**ï¼š`tig`ï¼ˆç»ˆç«¯ UIï¼‰
- **æ¡Œé¢ç«¯**ï¼š
    - GitHub Desktopï¼ˆç®€å•æ˜“ç”¨ï¼‰
    - Sourcetreeï¼ˆåŠŸèƒ½å…¨é¢ï¼‰
    - GitKrakenï¼ˆç¾è§‚å¼ºå¤§ï¼‰
    - VS Code å†…ç½® Git æ”¯æŒ

## åäº”ã€å­¦ä¹ èµ„æº

- å®˜æ–¹æ–‡æ¡£ï¼š[https://git-scm.com/doc](https://git-scm.com/doc)
- äº’åŠ¨æ•™ç¨‹ï¼š[Learn Git Branching](https://learngitbranching.js.org/)
- ä¹¦ç±ï¼šã€ŠPro Gitã€‹ï¼ˆå…è´¹åœ¨çº¿ç‰ˆï¼‰

> ğŸ’¡ **è®°ä½**ï¼šGit çš„æ ¸å¿ƒæ˜¯ **å¿«ç…§ï¼ˆsnapshotï¼‰**ï¼Œä¸æ˜¯â€œå·®å¼‚â€ã€‚æ¯æ¬¡æäº¤éƒ½æ˜¯æ•´ä¸ªé¡¹ç›®çš„ä¸€ä¸ªå¿«ç…§ã€‚
